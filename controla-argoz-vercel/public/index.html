<!doctype html>
<html lang="es-MX">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ERP ¬∑ Taller</title>
<style>
:root{
  --menu-bg:#0b1c2e; --menu-fg:#e6eef7;
  --grad-a:#6A11CB; --grad-b:#2575FC;
  --card:#fff; --line:#e6eaf3; --muted:#64748b; --btn:#3b82f6;
  --edit:#fff3e6; --edit-bd:#f59e0b; --lock:#f3f4f6; --lock-fg:#475569;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#f8fafc}
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
aside{background:var(--menu-bg);color:var(--menu-fg);padding:14px 12px}
.logo{font-weight:800;margin-bottom:10px}
.menu{display:flex;flex-direction:column;gap:6px}
.menu button{border:0;background:transparent;color:var(--menu-fg);padding:10px 12px;border-radius:10px;text-align:left;font-weight:600;cursor:pointer;opacity:.9}
.menu button:hover{opacity:1;background:#0f2942}
.menu button.active{opacity:1;background:linear-gradient(90deg,var(--grad-a),var(--grad-b));color:#fff}
main{padding:16px}
.workspace{max-width:1200px;margin:0 auto}
.topbar{display:flex;gap:10px;margin-bottom:12px}
.kpi{background:#fff;border:1px solid var(--line);border-radius:14px;padding:8px 12px;font-weight:800}

/* ===== Layout interno del m√≥dulo ===== */
.module{display:grid;grid-template-columns:240px 1fr;gap:16px;align-items:start}
.subcol{position:sticky;top:12px}
.subbox{display:flex;flex-direction:column;gap:8px}
.subbtn{
  display:flex;align-items:center;gap:8px;
  padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;
  font-weight:700;font-size:14px; cursor:pointer
}
.subbtn:hover{border-color:#cdd6e4}
.workcol{min-height:440px}
.tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.tab{border:1px solid var(--line);background:#fff;padding:6px 10px;border-radius:999px;font-size:13px;cursor:pointer}
.tab.active{background:#e2e8f0;font-weight:800}
.view{display:none}

/* Hoja de trabajo */
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px}
h1,h2{margin:0 0 10px;color:#0a2c4c}
.muted{color:var(--muted);font-size:12px}
.ht-sheet [data-edit]{background:var(--edit);border:1px solid var(--edit-bd)}
.ht-sheet [data-edit].locked{background:var(--lock)!important;color:var(--lock-fg);border:1px solid #cbd5e1}
.ht-toolbar{display:flex;gap:8px;margin-bottom:8px}
.ht-left{margin-right:auto}
.ht-btn{border:1px solid #cbd5e1;background:#fff;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
.ht-btn-blue{background:var(--btn);color:#fff;border:none}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.grid label{display:block;font-size:12px;color:#334155;margin-bottom:4px}
.grid input,.grid select,.grid textarea{width:100%;padding:8px 10px;border:1px solid #cbd5e1;border-radius:10px;font-size:14px}
.table{width:100%;border-collapse:collapse;table-layout:fixed}
.table th,.table td{border:1px solid var(--line);padding:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.table thead tr{background:#eef2ff}
.right{display:flex;justify-content:flex-end;margin-top:8px}
.money{font-weight:800}
@media print{aside,.topbar,.subcol,.tabs{display:none} main{padding:0}}
</style>
</head>
<body>
<div class="app">
  <aside>
    <div class="logo">ERP ¬∑ Taller</div>
    <div id="menu" class="menu">
      <button data-root="inicio" class="active">üè† Inicio</button>
      <button data-root="ventas">üßæ Ventas</button>
      <button data-root="inventarios">üì¶ Inventarios</button>
      <button data-root="pedidos">üìë Pedidos</button>
      <button data-root="produccion">üè≠ Producci√≥n</button>
      <button data-root="administracion">üóÇÔ∏è Administraci√≥n</button>
      <button data-root="personal">üë• Personal</button>
      <button data-root="catalogo">üìö Cat√°logo</button>
    </div>
  </aside>

  <main>
    <div class="workspace">
      <div class="topbar">
        <div class="kpi">Semana: <span id="kpiSemana"></span></div>
        <div class="kpi">Ventas: $ 0.00</div>
        <div class="kpi">Gastos: $ 0.00</div>
        <div class="kpi">Producci√≥n: 0 g</div>
      </div>

      <div id="moduleHost"></div>
    </div>
  </main>
</div>

<script>
/* ===== Base m√≠nima ===== */
const DBSLOT='erp_taller_db';
function loadDB(){ try{return JSON.parse(localStorage.getItem(DBSLOT)||'{}')}catch(e){return{}} }
function saveDB(db){ localStorage.setItem(DBSLOT, JSON.stringify(db)); }
function hoyStr(){ return new Date().toISOString().slice(0,10); }
function f2(x){ return (parseFloat(x||0)).toFixed(2); }
function escapeHTML(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m]))}

window.DB = loadDB();
DB.folios = DB.folios || {};
DB.movInv = DB.movInv || { entradas:[], salidas:[], traspasos:[], conciliaciones:[] };
DB.stock  = DB.stock  || {};
DB.admin  = DB.admin  || {};

(function semana(){
  const hoy=new Date(), lunes=new Date(hoy), d=(hoy.getDay()+6)%7; lunes.setDate(hoy.getDate()-d);
  const dom=new Date(lunes); dom.setDate(lunes.getDate()+6);
  const fmt=d=>d.toISOString().slice(0,10).split('-').reverse().join('/');
  document.getElementById('kpiSemana').textContent=fmt(lunes)+' ‚Äì '+fmt(dom);
})();

/* ===== Router de m√≥dulos ===== */
const host=document.getElementById('moduleHost');
document.getElementById('menu').addEventListener('click',(e)=>{
  const b=e.target.closest('button[data-root]'); if(!b) return;
  document.querySelectorAll('.menu button').forEach(x=>x.classList.remove('active')); b.classList.add('active');
  host.innerHTML='';
  if(b.dataset.root==='inventarios'){ renderInventarios(host); return; }
  if(b.dataset.root==='administracion'){ renderAdministracion(host); return; }
  const card=document.createElement('div');
  card.className='card';
  card.innerHTML='<h2>'+b.textContent.split(' ').slice(1).join(' ')+'</h2><p class="muted">M√≥dulo en construcci√≥n.</p>';
  host.appendChild(card);
});

/* Auto: Inicio */
document.querySelector('button[data-root="inicio"]').click();

/* Exponer utilidades (las usan los m√≥dulos) */
window.saveDB = saveDB;
window.f2 = f2;
window.hoyStr = hoyStr;
window.escapeHTML = escapeHTML;
</script>

<!-- M√ìDULOS -->
<script src="./mod_inventarios.js"></script>
<script src="./Mod_administracion.js"></script> <!-- üëà coincide EXACTO con tu archivo -->
</body>
</html>

// router_unificado.js
// Enrutador m√≠nimo para el ERP modular (Inventarios / Administraci√≥n)
// Usa botones del men√∫ lateral con data-route="inventarios" | "administracion"
// y un contenedor principal con id="moduleHost".

import { renderInventarios } from './Mod_inventarios.js';
import { renderAdministracion } from './Mod_administracion.js';

const routes = {
  inventarios: renderInventarios,
  administracion: renderAdministracion,
};

export function initRouter() {
  const moduleHost = document.getElementById('moduleHost');

  function setActive(route) {
    document.querySelectorAll('aside.mainmenu [data-route]').forEach(b => {
      b.classList.toggle('active', b.dataset.route === route);
    });
  }

  function go(route) {
    const render = routes[route] || routes.inventarios;
    render(moduleHost);
    setActive(route);
  }

  function current() {
    return (location.hash.replace('#','') || 'inventarios');
  }

  window.addEventListener('hashchange', () => go(current()));

  document.querySelectorAll('aside.mainmenu [data-route]').forEach(b => {
    b.addEventListener('click', () => {
      if (b.dataset.route) location.hash = b.dataset.route;
    });
  });

  go(current());
}

// Auto-inicializa cuando el script se carga despu√©s del DOM.
if (document.readyState !== 'loading') { initRouter(); }
else { document.addEventListener('DOMContentLoaded', initRouter); }
